.TH SPRAT-CLI 1 "February 2026" "sprat-cli" "User Commands"
.SH NAME
sprat-cli \- sprite atlas layout and packing pipeline
.SH SYNOPSIS
.B spratlayout
.I folder
[\fB\-\-profile\fR \fINAME\fR]
[\fB\-\-profiles\-config\fR \fIPATH\fR]
[\fB\-\-mode\fR compact|pot|fast]
[\fB\-\-optimize\fR gpu|space]
[\fB\-\-max\-width\fR \fIN\fR]
[\fB\-\-max\-height\fR \fIN\fR]
[\fB\-\-padding\fR \fIN\fR]
[\fB\-\-max\-combinations\fR \fIN\fR]
[\fB\-\-source\-resolution\fR \fIWxH\fR]
[\fB\-\-target\-resolution\fR \fIWxH\fR]
[\fB\-\-resolution\-reference\fR largest|smallest]
[\fB\-\-scale\fR \fIF\fR]
[\fB\-\-trim\-transparent\fR]
.PP
.B spratpack
[\fB\-\-frame\-lines\fR]
[\fB\-\-line\-width\fR \fIN\fR]
[\fB\-\-line\-color\fR \fIR,G,B[,A]\fR]
[\fB\-\-threads\fR \fIN\fR]
.PP
.B spratconvert
[\fB\-\-transform\fR \fINAME|PATH\fR]
[\fB\-\-list\-transforms\fR]
[\fB\-\-markers\fR \fIPATH\fR]
[\fB\-\-animations\fR \fIPATH\fR]
.PP
.B spratframes
[\fB\-\-has\-rectangles\fR]
[\fB\-\-rectangle\-color\fR \fICOLOR\fR]
[\fB\-\-tolerance\fR \fIN\fR]
[\fB\-\-min\-size\fR \fIN\fR]
[\fB\-\-max\-sprites\fR \fIN\fR]
[\fB\-\-threads\fR \fIN\fR]
.I input_image
.PP
.B spratunpack
[\fIatlas.png\fR|\fB\-\fR]
[\fB\-\-frames\fR \fIPATH\fR]
[\fB\-\-output\fR \fIDIR\fR]
[\fB\-\-threads\fR \fIN\fR]
.SH DESCRIPTION
\fBsprat\-cli\fR is a UNIX pipeline for generating sprite sheets and transforming layout metadata.
.PP
\fBspratlayout\fR scans an image folder and writes a text layout to standard output.
.PP
\fBspratpack\fR reads the layout from standard input and writes a PNG atlas to standard output.
.PP
\fBspratconvert\fR reads the same layout format from standard input and transforms it into text formats (for example JSON, CSV, XML, CSS) using template-driven transforms.
.PP
\fBspratframes\fR detects sprite rectangles in a sprite sheet and writes them to standard output in the spratframes format.
.PP
\fBspratunpack\fR extracts sprites from an atlas using a frames definition file. If no output directory is specified, it writes a TAR stream to stdout.
.PP
Normal output is written to stdout. Errors are written to stderr.
.SH COMMANDS
.SS spratlayout
Reads image metadata from files in \fIfolder\fR and prints layout lines:
.PP
atlas \fIwidth,height\fR
.br
scale \fIfactor\fR
.br
sprite "\fIpath\fR" \fIx,y\fR \fIw,h\fR [\fIleft,top right,bottom\fR]
.PP
If \fB\-\-trim\-transparent\fR is enabled, trim offsets are included per sprite.
.PP
If rotation is used for a sprite, the sprite line ends with \fBrotated\fR.
.PP
If \fIfolder\fR is actually a text file, it is treated as a newline-delimited list of image paths (comments starting with \fB#\fR and blank lines are ignored). Relative paths are resolved relative to the list file, and each path must point to an existing image or the command fails.
.PP
Profile configuration is loaded from the first existing file in this order:
.IP "\(bu" 2
\fB\-\-profiles\-config\fR path (when provided)
.IP "\(bu" 2
\fB~/.config/sprat/spratprofiles.cfg\fR (Linux/macOS) or \fB%APPDATA%\\sprat\\spratprofiles.cfg\fR (Windows)
.IP "\(bu" 2
\fB./spratprofiles.cfg\fR in the current working directory
.IP "\(bu" 2
Global installed config (typically \fB/usr/local/share/sprat/spratprofiles.cfg\fR)
.PP
Profile values act as defaults; CLI options override them per run.
.PP
Performance cache:
.IP "\(bu" 2
Metadata and output caches are stored in the system temp directory.
.IP "\(bu" 2
Unchanged inputs/options reuse cached results.
.IP "\(bu" 2
Entries older than one hour are pruned automatically.
.SS spratpack
Reads layout text from stdin and writes a PNG stream to stdout.
.PP
Layout accepts:
.br
atlas \fIwidth,height\fR (or legacy \fIatlas width height\fR)
.br
scale \fIfactor\fR
.br
sprite lines in current or legacy numeric format
.br
current sprite lines may include trailing \fBrotated\fR token
.SS spratconvert
Reads layout text from stdin and writes transformed text to stdout.
.PP
Unsuffixed placeholders are auto-encoded based on output type inferred from transform metadata (\fBmeta.extension\fR) or transform name/argument.
.PP
Transforms can be selected by name from \fBtransforms/\fR (for example \fBjson\fR, \fBcsv\fR, \fBxml\fR, \fBcss\fR) or by path to a custom \fB.transform\fR file.
.PP
Optional \fB\-\-markers\fR and \fB\-\-animations\fR files can be loaded and referenced by transform placeholders.
.PP
Transform sections use explicit open/close tags (for example \fB[meta]\fR ... \fB[/meta]\fR) or the modern line-based DSL (for example \fBmeta\fR, \fBheader\fR, \fBsprites\fR, \fB- sprite\fR).
.PP
The core structure is defined by iteration blocks:
.IP "\(bu" 2
\fBSprites\fR: \fB[sprites]\fR containing \fB[sprite]\fR (or \fBsprites\fR containing \fB- sprite\fR).
.IP "\(bu" 2
\fBAnimations\fR: \fB[animations]\fR containing \fB[animation]\fR (or \fBanimations\fR containing \fB- animation\fR).
.IP "\(bu" 2
\fBMarkers\fR: \fB[markers]\fR containing \fB[marker]\fR (or \fBmarkers\fR containing \fB- marker\fR).
.PP
Templates support marker/animation conditional sections (\fB[if_markers]\fR, \fB[if_no_markers]\fR, \fB[if_animations]\fR, \fB[if_no_animations]\fR) and optional separator/header/footer sections.
.PP
Placeholders:
.IP "\(bu" 2
\fBSprite fields\fR: \fB{{name}}\fR (basename without extension), \fB{{path}}\fR, \fB{{x}}\fR, \fB{{y}}\fR, \fB{{w}}\fR, \fB{{h}}\fR.
.IP "\(bu" 2
\fBSprite rotation\fR: \fB{{rotated}}\fR (\fBtrue\fR when the sprite was packed rotated, else \fBfalse\fR).
.IP "\(bu" 2
\fBMarker fields\fR: \fB{{marker_name}}\fR, \fB{{marker_type}}\fR, \fB{{marker_sprite_index}}\fR, \fB{{marker_sprite_name}}\fR.
.IP "\(bu" 2
\fBAnimation fields\fR: \fB{{animation_name}}\fR, \fB{{animation_sprite_indexes_json}}\fR.
.IP "\(bu" 2
Typed placeholders (for example \fB{{name_json}}\fR, \fB{{marker_vertices_xml}}\fR) are explicit and recommended.
.PP
Built-in JSON transform output omits \fBindex\fR fields from \fBsprites[]\fR and \fBanimations[]\fR.
.SS spratframes
Scans \fIinput_image\fR and detects sprite boundaries by finding non-transparent connected components or by detecting rectangles of a specific color.
Prints layout-compatible lines:
.PP
path \fIinput_image\fR
.br
[background \fIr,g,b\fR]
.br
sprite \fIx,y\fR \fIw,h\fR
.SS spratunpack
Extracts individual sprites from an \fIatlas.png\fR using a frames definition (JSON format as generated by \fBspratconvert\fR).
Atlas input can be a file path, \fB\-\fR, or standard input (when no atlas path is given).
If \fB\-\-frames\fR is not specified, it looks for a JSON file with the same base name as the atlas path (path input only).
.SH OPTIONS
.SS spratlayout
.TP
\fB\-\-profile\fR \fINAME\fR
Profile name loaded from profile config. Default: \fBfast\fR.
.TP
\fB\-\-profiles\-config\fR \fIPATH\fR
Use an explicit profile configuration file.
.TP
\fB\-\-mode\fR compact|pot|fast
Override packing mode from selected profile.
.TP
\fB\-\-optimize\fR gpu|space
Override optimization target from selected profile.
.TP
\fB\-\-max\-width\fR \fIN\fR
Maximum atlas width. Overrides profile value.
.TP
\fB\-\-max\-height\fR \fIN\fR
Maximum atlas height. Overrides profile value.
.TP
\fB\-\-padding\fR \fIN\fR
Extra pixels between packed sprites. Overrides profile value.
.TP
\fB\-\-max\-combinations\fR \fIN\fR
Maximum number of compact candidate combinations to test (\fB0\fR means auto/unlimited). Overrides profile value.
.TP
\fB\-\-source\-resolution\fR \fIWxH\fR
Source design resolution baseline (for example \fB800x600\fR). Must be used together with \fB\-\-target\-resolution\fR.
.TP
\fB\-\-target\-resolution\fR \fIWxH\fR
Target output resolution (for example \fB800x600\fR). Must be used together with \fB\-\-source\-resolution\fR.
.TP
\fB\-\-resolution\-reference\fR largest|smallest
Choose which axis ratio drives source/target resolution scaling. Default: \fBlargest\fR.
.TP
\fB\-\-scale\fR \fIF\fR
Pre-scale factor applied before source/target resolution mapping. Valid range: \fB0 < F <= 1\fR. Overrides profile value.
.TP
\fB\-\-trim\-transparent\fR
Enable transparent-border trimming (overrides profile value).
.TP
\fB\-\-rotate\fR
Enable 90-degree sprite rotation during packing (overrides profile value).
.PP
Config keys available per profile section:
.IP "\(bu" 2
\fBmode=compact|pot|fast\fR
.IP "\(bu" 2
\fBoptimize=gpu|space\fR
.IP "\(bu" 2
\fBmax_width\fR, \fBmax_height\fR
.IP "\(bu" 2
\fBpadding\fR, \fBmax_combinations\fR
.IP "\(bu" 2
\fBscale\fR (\fB0 < scale <= 1\fR), \fBtrim_transparent\fR, \fBthreads\fR
.SS spratpack
.TP
\fB\-\-frame\-lines\fR
Draw rectangle outlines for each sprite.
.TP
\fB\-\-line\-width\fR \fIN\fR
Outline thickness in pixels. Default: \fB1\fR.
.TP
\fB\-\-line\-color\fR \fIR,G,B[,A]\fR
Outline color channels (0-255). Default: \fB255,0,0,255\fR.
.TP
\fB\-\-threads\fR \fIN\fR
Worker thread count for sprite decode/blit. Used when sprite rectangles do not overlap. Default: auto.
.SS spratconvert
.TP
\fB\-\-transform\fR \fINAME|PATH\fR
Transform name from \fBtransforms/\fR or path to a custom transform file. Default: \fBjson\fR.
.TP
\fB\-\-list\-transforms\fR
Print available transforms and exit.
.TP
\fB\-\-markers\fR \fIPATH\fR
Load external markers plaintext file using the \fBpath\fR and \fB- marker\fR DSL.
Supported marker types: \fBpoint\fR (\fBx,y\fR), \fBcircle\fR (\fBx,y radius\fR), \fBrectangle\fR (\fBx,y w,h\fR), \fBpolygon\fR (\fBx,y x,y ...\fR).
.TP
\fB\-\-animations\fR \fIPATH\fR
Load external animations plaintext file using the \fBanimation\fR and \fB- frame\fR DSL.
.SS spratframes
.TP
\fB\-\-has\-rectangles\fR
Instead of transparency-based detection, look for closed rectangles of a specific color.
.TP
\fB\-\-rectangle\-color\fR \fICOLOR\fR
Color of rectangle borders to detect. Formats: #RRGGBB, #RGB, RGB(r,g,b), r,g,b. Default: \fB255,0,255\fR (magenta).
.TP
\fB\-\-tolerance\fR \fIN\fR
Distance tolerance in pixels for grouping non-transparent pixels into sprites. Default: \fB1\fR.
.TP
\fB\-\-min\-size\fR \fIN\fR
Minimum width/height for a detected sprite to be included. Default: \fB4\fR.
.TP
\fB\-\-max\-sprites\fR \fIN\fR
Limit the maximum number of sprites to detect. Default: \fB10000\fR.
.TP
\fB\-\-threads\fR \fIN\fR
Number of worker threads. Default: auto.
.SS spratunpack
.TP
\fB\-f\fR, \fB\-\-frames\fR \fIPATH\fR
Path to the JSON frames definition file.
.TP
\fB\-o\fR, \fB\-\-output\fR \fIDIR\fR
Directory where extracted sprites will be saved. If omitted, sprites are written as a TAR stream to stdout.
.TP
\fB\-j\fR, \fB\-\-threads\fR \fIN\fR
Number of worker threads for sprite extraction. Default: auto.
.SH EXAMPLES
.TP
Generate layout text:
.B spratlayout ./frames > layout.txt
.TP
Pack PNG from layout:
.B spratpack < layout.txt > spritesheet.png
.TP
Transform layout to JSON:
.B spratconvert --transform json < layout.txt > layout.json
.TP
Transform layout with custom template:
.B spratconvert --transform ./my.transform < layout.txt > layout.custom.txt
.TP
Transform layout with extra files:
.B spratconvert --transform json --markers markers.txt --animations animations.txt < layout.txt > layout.json
.TP
Run as one pipeline:
.B spratlayout ./frames --trim-transparent --padding 2 | spratpack > spritesheet.png
.TP
Debug frame bounds:
.B spratpack --frame-lines --line-width 2 --line-color 0,255,0 < layout.txt > spritesheet_lines.png
.TP
Limit worker threads:
.B spratlayout ./frames --threads 4 > layout.txt ; spratpack --threads 4 < layout.txt > spritesheet.png
.TP
Detect sprites in a sheet:
.B spratframes sheet.png > frames.spratframes
.TP
Unpack an atlas to a directory:
.B spratunpack atlas.png --frames atlas.json --output ./extracted
.TP
Unpack atlas to TAR (stdout):
.B spratunpack atlas.png > sprites.tar
.TP
Unpack atlas from stdin to TAR (stdout):
.B cat atlas.png | spratunpack --frames atlas.json > sprites.tar
.SH EXIT STATUS
All commands return:
.TP
\fB0\fR
Success.
.TP
\fB1\fR
Invalid arguments, invalid input data, image decode/encode failure, or packing failure.
.SH SEE ALSO
\fBspratlayout\fR(1), \fBspratpack\fR(1), \fBspratconvert\fR(1), \fBspratframes\fR(1), \fBspratunpack\fR(1)
